<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Schedule Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            body { 
                print-color-adjust: exact; 
                -webkit-print-color-adjust: exact;
                background: white !important;
                padding: 20px !important;
            }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .screen-only { display: none !important; }
            select { border: 0 !important; appearance: none; pointer-events: none; }
        }
        .print-only { display: none; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <svg class="w-10 h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <h1 class="text-4xl font-bold text-gray-800">Work Schedule Manager</h1>
                </div>
                <button onclick="window.print()" class="no-print flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-all shadow-lg hover:shadow-xl">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                        <rect x="6" y="14" width="12" height="8"></rect>
                    </svg>
                    Print PDF
                </button>
            </div>

            <!-- Controls -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Month/Year Selection -->
                <div class="space-y-3">
                    <label class="block text-sm font-semibold text-gray-700">Month & Year</label>
                    <div class="flex gap-3">
                        <select id="monthSelect" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="0">January</option>
                            <option value="1">February</option>
                            <option value="2">March</option>
                            <option value="3">April</option>
                            <option value="4">May</option>
                            <option value="5">June</option>
                            <option value="6">July</option>
                            <option value="7">August</option>
                            <option value="8">September</option>
                            <option value="9">October</option>
                            <option value="10">November</option>
                            <option value="11">December</option>
                        </select>
                        <input type="number" id="yearInput" class="w-28 px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                </div>

                <!-- Staff Filter -->
                <div class="space-y-3">
                    <label class="block text-sm font-semibold text-gray-700">Filter by Staff</label>
                    <select id="staffFilter" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <option value="all">All Staff</option>
                    </select>
                </div>

                <!-- Add Staff -->
                <div class="space-y-3">
                    <label class="block text-sm font-semibold text-gray-700">Add Staff Member</label>
                    <div class="flex gap-3">
                        <input type="text" id="newStaffInput" placeholder="Enter name" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <button onclick="addStaff()" class="px-4 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-all shadow-md">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Schedule Table -->
        <div class="bg-white rounded-2xl shadow-xl p-8 screen-only">
            <h2 id="scheduleTitle" class="text-2xl font-bold text-gray-800 mb-6"></h2>
            <div id="scheduleContainer"></div>
        </div>

        <!-- Print-Only Simple Calendar -->
        <div class="print-only" id="printContainer"></div>
    </div>

    <script>
        // State
        let staff = [];
        let schedules = {};
        let selectedMonth = new Date().getMonth();
        let selectedYear = new Date().getFullYear();
        let selectedStaff = 'all';

        // Load data from localStorage
        function loadData() {
            const savedStaff = localStorage.getItem('workScheduleStaff');
            const savedSchedules = localStorage.getItem('workScheduleData');
            
            if (savedStaff) {
                staff = JSON.parse(savedStaff);
            } else {
                staff = ['Employee 1', 'Employee 2'];
            }
            
            if (savedSchedules) {
                schedules = JSON.parse(savedSchedules);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('workScheduleStaff', JSON.stringify(staff));
            localStorage.setItem('workScheduleData', JSON.stringify(schedules));
        }

        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

        // Initialize
        function init() {
            loadData();
            
            document.getElementById('monthSelect').value = selectedMonth;
            document.getElementById('yearInput').value = selectedYear;
            
            document.getElementById('monthSelect').addEventListener('change', (e) => {
                selectedMonth = parseInt(e.target.value);
                render();
            });
            
            document.getElementById('yearInput').addEventListener('change', (e) => {
                selectedYear = parseInt(e.target.value);
                render();
            });
            
            document.getElementById('staffFilter').addEventListener('change', (e) => {
                selectedStaff = e.target.value;
                render();
            });
            
            document.getElementById('newStaffInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addStaff();
            });
            
            updateStaffFilter();
            render();
        }

        function addStaff() {
            const input = document.getElementById('newStaffInput');
            const name = input.value.trim();
            if (name && !staff.includes(name)) {
                staff.push(name);
                input.value = '';
                saveData();
                updateStaffFilter();
                render();
            }
        }

        function removeStaff(name) {
            staff = staff.filter(s => s !== name);
            delete schedules[name];
            saveData();
            updateStaffFilter();
            render();
        }

        function updateStaffFilter() {
            const filter = document.getElementById('staffFilter');
            const current = filter.value;
            filter.innerHTML = '<option value="all">All Staff</option>';
            staff.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s;
                opt.textContent = s;
                filter.appendChild(opt);
            });
            filter.value = staff.includes(current) ? current : 'all';
            selectedStaff = filter.value;
        }

        function getDaysInMonth(month, year) {
            return new Date(year, month + 1, 0).getDate();
        }

        function getFirstDayOfMonth(month, year) {
            return new Date(year, month, 1).getDay();
        }

        function getSchedule(staffName, day) {
            const key = `${selectedYear}-${selectedMonth}-${day}`;
            return schedules[staffName]?.[key] || 'OFF';
        }

        function setSchedule(staffName, day, value) {
            if (!schedules[staffName]) schedules[staffName] = {};
            schedules[staffName][`${selectedYear}-${selectedMonth}-${day}`] = value;
            saveData();
            render();
        }

        function copyWeekSchedule(staffName, weekDays) {
            // Get the schedule for current week
            const weekSchedule = [];
            weekDays.forEach(day => {
                if (day) {
                    weekSchedule.push(getSchedule(staffName, day));
                }
            });

            // Find the next week's days
            const daysInMonth = getDaysInMonth(selectedMonth, selectedYear);
            const lastDayOfWeek = weekDays.filter(d => d !== null).pop();
            
            if (!lastDayOfWeek) return;

            let scheduleIndex = 0;
            for (let day = lastDayOfWeek + 1; day <= Math.min(lastDayOfWeek + 7, daysInMonth); day++) {
                if (scheduleIndex < weekSchedule.length) {
                    setSchedule(staffName, day, weekSchedule[scheduleIndex]);
                    scheduleIndex++;
                }
            }

            saveData();
            render();
        }

        function getWeeks(firstDay, daysInMonth) {
            const weeks = [];
            let week = [];
            
            for (let i = 0; i < firstDay; i++) {
                week.push(null);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                week.push(day);
                if (week.length === 7 || day === daysInMonth) {
                    while (week.length < 7) {
                        week.push(null);
                    }
                    weeks.push(week);
                    week = [];
                }
            }
            
            return weeks;
        }

        function countWorkDays(staffName, days) {
            let main = 0, branch = 0, off = 0;
            days.forEach(day => {
                if (day) {
                    const schedule = getSchedule(staffName, day);
                    if (schedule === 'MAIN') main++;
                    else if (schedule === 'BRANCH') branch++;
                    else off++;
                }
            });
            return { main, branch, off, total: main + branch };
        }

        function countMonthDays(staffName, daysInMonth) {
            let main = 0, branch = 0, off = 0;
            for (let day = 1; day <= daysInMonth; day++) {
                const schedule = getSchedule(staffName, day);
                if (schedule === 'MAIN') main++;
                else if (schedule === 'BRANCH') branch++;
                else off++;
            }
            return { main, branch, off, total: main + branch };
        }

        function render() {
            document.getElementById('scheduleTitle').textContent = `${months[selectedMonth]} ${selectedYear} Schedule`;
            
            const daysInMonth = getDaysInMonth(selectedMonth, selectedYear);
            const firstDay = getFirstDayOfMonth(selectedMonth, selectedYear);
            const weeks = getWeeks(firstDay, daysInMonth);
            const filteredStaff = selectedStaff === 'all' ? staff : staff.filter(s => s === selectedStaff);
            
            const container = document.getElementById('scheduleContainer');
            
            if (filteredStaff.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-400">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <p class="text-lg">No staff members added yet. Add some to get started!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredStaff.forEach(staffName => {
                const monthStats = countMonthDays(staffName, daysInMonth);
                
                html += `
                    <div class="mb-12 last:mb-0">
                        <div class="flex items-center justify-between mb-4 pb-4 border-b-2 border-gray-200">
                            <div class="flex items-center gap-3">
                                <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                <h3 class="text-xl font-bold text-gray-800">${staffName}</h3>
                            </div>
                            <div class="flex items-center gap-6">
                                <div class="text-sm">
                                    <span class="font-semibold">Month Total: </span>
                                    <span class="text-blue-600 font-bold">${monthStats.main}M</span>
                                    <span class="mx-1">+</span>
                                    <span class="text-purple-600 font-bold">${monthStats.branch}B</span>
                                    <span class="mx-2">=</span>
                                    <span class="text-green-600 font-bold text-lg">${monthStats.total} days</span>
                                </div>
                                <button onclick="removeStaff('${staffName}')" class="no-print p-2 text-red-500 hover:bg-red-50 rounded-lg transition-all">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                `;
                
                weeks.forEach((week, weekIdx) => {
                    const weekStats = countWorkDays(staffName, week);
                    const lastDayOfWeek = week.filter(d => d !== null).pop();
                    const daysInMonth = getDaysInMonth(selectedMonth, selectedYear);
                    const hasNextWeek = lastDayOfWeek && lastDayOfWeek < daysInMonth;
                    
                    html += `
                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-sm font-semibold text-gray-600">Week ${weekIdx + 1}</span>
                                <div class="flex items-center gap-4">
                                    <span class="text-sm text-gray-600">
                                        Weekly: <span class="text-blue-600 font-semibold">${weekStats.main}M</span> + 
                                        <span class="text-purple-600 font-semibold">${weekStats.branch}B</span> = 
                                        <span class="text-green-600 font-bold">${weekStats.total} days</span>
                                    </span>
                                    ${hasNextWeek ? `
                                        <button onclick="copyWeekSchedule('${staffName}', ${JSON.stringify(week).replace(/"/g, '&quot;')})" 
                                                class="no-print px-3 py-1 text-xs bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-all">
                                            Copy to Next Week
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-7 gap-3">
                    `;
                    
                    ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach((dayName, idx) => {
                        const day = week[idx];
                        html += `<div class="text-center">
                            <div class="text-xs font-semibold text-gray-500 mb-2">${dayName}</div>`;
                        
                        if (day) {
                            const schedule = getSchedule(staffName, day);
                            const bgClass = schedule === 'MAIN' ? 'bg-blue-100 border-blue-300 text-blue-700' :
                                          schedule === 'BRANCH' ? 'bg-purple-100 border-purple-300 text-purple-700' :
                                          'bg-gray-100 border-gray-300 text-gray-600';
                            
                            html += `
                                <div class="space-y-2">
                                    <div class="text-sm font-bold text-gray-700 bg-gray-100 rounded-lg py-1">${day}</div>
                                    <select onchange="setSchedule('${staffName}', ${day}, this.value)" 
                                            class="w-full px-2 py-2 text-sm font-semibold rounded-lg border-2 transition-all ${bgClass}">
                                        <option value="OFF" ${schedule === 'OFF' ? 'selected' : ''}>OFF</option>
                                        <option value="MAIN" ${schedule === 'MAIN' ? 'selected' : ''}>MAIN</option>
                                        <option value="BRANCH" ${schedule === 'BRANCH' ? 'selected' : ''}>BRANCH</option>
                                    </select>
                                </div>
                            `;
                        } else {
                            html += '<div class="h-20"></div>';
                        }
                        
                        html += '</div>';
                    });
                    
                    html += `</div></div>`;
                });
                
                html += '</div>';
            });
            
            container.innerHTML = html;
            
            // Render print version
            renderPrintVersion(filteredStaff, daysInMonth, firstDay);
        }

        // Start the app
        init();

        function renderPrintVersion(filteredStaff, daysInMonth, firstDay) {
            const printContainer = document.getElementById('printContainer');
            let printHTML = `<div style="font-family: Arial, sans-serif; padding: 20px;">`;

            filteredStaff.forEach((staffName, staffIdx) => {
                if (staffIdx > 0) printHTML += '<div style="page-break-before: always;"></div>';
                
                const monthStats = countMonthDays(staffName, daysInMonth);
                
                printHTML += `
                    <div style="margin-bottom: 30px;">
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 18px; font-weight: bold;">${months[selectedMonth]} ${selectedYear}</div>
                            <div style="font-size: 16px; margin-top: 5px;">Staff: ${staffName}</div>
                        </div>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                            <thead>
                                <tr>
                                    <th style="border: 1px solid #000; padding: 8px; background: #f0f0f0; font-weight: bold;">Sun</th>
                                    <th style="border: 1px solid #000; padding: 8px; background: #f0f0f0; font-weight: bold;">Mon</th>
                                    <th style="border: 1px solid #000; padding: 8px; background: #f0f0f0; font-weight: bold;">Tue</th>
                                    <th style="border: 1px solid #000; padding: 8px; background: #f0f0f0; font-weight: bold;">Wed</th>
                                    <th style="border: 1px solid #000; padding: 8px; background: #f0f0f0; font-weight: bold;">Thu</th>
                                    <th style="border: 1px solid #000; padding: 8px; background: #f0f0f0; font-weight: bold;">Fri</th>
                                    <th style="border: 1px solid #000; padding: 8px; background: #f0f0f0; font-weight: bold;">Sat</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                const weeks = getWeeks(firstDay, daysInMonth);
                weeks.forEach(week => {
                    printHTML += '<tr>';
                    week.forEach(day => {
                        if (day) {
                            const schedule = getSchedule(staffName, day);
                            printHTML += `
                                <td style="border: 1px solid #000; padding: 8px; text-align: center; vertical-align: top;">
                                    <div style="font-weight: bold; font-size: 16px; margin-bottom: 4px;">${day}</div>
                                    <div style="font-size: 12px;">${schedule}</div>
                                </td>
                            `;
                        } else {
                            printHTML += '<td style="border: 1px solid #000; padding: 8px; background: #f9f9f9;"></td>';
                        }
                    });
                    printHTML += '</tr>';
                });

                printHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            });

            printHTML += '</div>';
            printContainer.innerHTML = printHTML;
        }
    </script>
</body>
</html>